<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Living Document Viewer</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        scroll-behavior: smooth;
        background: #f9f9f9;
    }
#sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 250px;
    height: 100%;
    background: #111;
    border-right: 1px solid #333;
    display: flex;
    flex-direction: column;
}

#search {
    padding: 6px;
    border: none;
    border-radius: 4px;
    background: #333;
    color: #fff;
    position: sticky;
    top: 0;
    z-index: 10;
    margin: 0;
}

#search::placeholder {
    color: #aaa;
}

#toc {
    list-style: none;
    padding-left: 0;
    margin-top: 10px;
    overflow-y: auto;
}

    }
    #toc li {
        margin-bottom: 5px;
    }
    #toc a {
        text-decoration: none;
        color: #ccc;
        transition: color 0.2s ease, background 0.2s ease;
        display: block;
        padding: 4px;
        border-radius: 4px;
    }
    #toc a:hover {
        color: #fff;
        background: #222;
    }
    #toc a.active {
        color: #fff;
        background: #444;
    }
    #content {
        margin-left: 260px;
        padding: 20px;
        max-width: 900px;
        background: #fff;
        color: #222;
        min-height: 100vh;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
    }
    a {
        text-decoration: none;
        color: #0056b3;
    }
    a:hover {
        text-decoration: underline;
    }
    /* Glow effect for active heading */
    .active-heading {
        text-shadow: 0 0 10px rgba(0,0,0,0.2);
        background: #f0f8ff;
        border-radius: 4px;
        padding: 2px 4px;
        transition: background 0.3s ease;
    }
</style>
</head>
<body>

<div id="sidebar">
    <input type="text" id="search" placeholder="Search headings...">
    <ul id="toc"></ul>
</div>

<div id="content">
    <p>Loading content...</p>
</div>

<script>
fetch('content.html')
    .then(res => res.text())
    .then(html => {
        document.getElementById('content').innerHTML = html;
        generateTOC();
        setupLazyLoading();
        highlightOnScroll();
    });

function generateTOC() {
    const toc = document.getElementById('toc');
    const content = document.getElementById('content');
    const headings = content.querySelectorAll('h1, h2, h3');

    headings.forEach((heading, index) => {
        const id = 'heading-' + index;
        heading.id = id;
        const li = document.createElement('li');
        li.style.marginLeft = (parseInt(heading.tagName[1]) - 1) * 10 + 'px';
        li.innerHTML = `<a href="#${id}">${heading.textContent}</a>`;
        toc.appendChild(li);
    });

    document.getElementById('search').addEventListener('input', function () {
        const term = this.value.toLowerCase();
        toc.querySelectorAll('li').forEach(li => {
            li.style.display = li.textContent.toLowerCase().includes(term) ? '' : 'none';
        });
    });
}

function setupLazyLoading() {
    const images = document.querySelectorAll('#content img');
    images.forEach(img => {
        img.loading = "lazy";
        img.style.maxWidth = "100%";
        img.style.height = "auto";
    });
}

function highlightOnScroll() {
    const tocLinks = document.querySelectorAll('#toc a');
    const headings = document.querySelectorAll('#content h1, #content h2, #content h3');

    window.addEventListener('scroll', () => {
        let current = '';
        headings.forEach(heading => {
            const rect = heading.getBoundingClientRect();
            if (rect.top <= 150 && rect.bottom > 150) {
                current = heading.id;
            }
        });

        tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === '#' + current) {
                link.classList.add('active');
            }
        });

        headings.forEach(h => h.classList.remove('active-heading'));
        if (current) {
            document.getElementById(current).classList.add('active-heading');
        }
    });
}
</script>

</body>
</html>
